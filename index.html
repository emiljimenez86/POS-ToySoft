<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ToySoft - Sistema POS</title>
  <meta name="description" content="Sistema de Punto de Venta para Restaurantes">
  <meta name="theme-color" content="#0dcaf0">
  
  <!-- PWA Meta Tags -->
  <meta name="application-name" content="ToySoft POS">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="ToySoft POS">
  <meta name="format-detection" content="telephone=no">
  <meta name="mobile-web-app-capable" content="yes">
  
  <!-- PWA Icons -->
  <link rel="icon" type="image/png" sizes="32x32" href="./image/logo-ToySoft.png">
  <link rel="icon" type="image/png" sizes="16x16" href="./image/logo-ToySoft.png">
  <link rel="apple-touch-icon" sizes="180x180" href="./image/logo-ToySoft.png">
  <link rel="mask-icon" href="./image/logo-ToySoft.png" color="#0dcaf0">
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="./manifest.json">
  
  <!-- Styles -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <style>
    body {
      display: block !important;
    }
    #appSection, #loginSection {
      display: none;
    }
  </style>
</head>
<body class="d-flex flex-column min-vh-100">
  <!-- Spinner de carga personalizado -->
  <div id="customLoader" style="position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:9999;display:flex;align-items:center;justify-content:center;background:#181818;">
    <div style="text-align:center;">
      <img src="image/logo-ToySoft.png" alt="Cargando..." style="width:90px;height:90px;border-radius:50%;background:#fff;box-shadow:0 0 20px #0dcaf0;animation:spin 1.5s linear infinite;">
      <div style="color:#0dcaf0;font-weight:bold;margin-top:14px;letter-spacing:1px;">Cargando ToySoft...</div>
    </div>
  </div>

  <div id="mainContent" style="display:none;">
    <div class="container-fluid flex-grow-1">
      <!-- Sección de Login -->
      <div id="loginSection" class="login-container">
        <div class="logo-container">
          <img src="image/logo-ToySoft.png" alt="Logo" class="img-fluid" style="max-width: 120px;">
        </div>
        <div class="welcome-message">
          <h2 class="text-info">¡Bienvenido al Sistema POS!</h2>
          <p class="welcome-subtitle small">Gestiona tu restaurante de manera eficiente y profesional</p>
        </div>
        <form onsubmit="event.preventDefault(); iniciarSesionFirebase();">
          <div class="mb-2">
            <input type="email" id="email" class="form-control form-control-sm" placeholder="Correo electrónico" required>
          </div>
          <div class="mb-2">
            <input type="password" id="password" class="form-control form-control-sm" placeholder="Contraseña" required>
          </div>
          <div class="d-grid">
            <button type="submit" class="btn btn-info btn-sm">Iniciar Sesión</button>
          </div>
        </form>
        
        <!-- Separador -->
        <div class="text-center my-2">
          <span class="text-muted small">o</span>
        </div>
        
        <!-- Botón de Google -->
        <div class="d-grid mb-2">
          <button class="btn btn-outline-light btn-sm" onclick="iniciarSesionGoogle()" id="btnGoogle">
            <i class="fab fa-google me-2"></i>Continuar con Google
          </button>
        </div>
        
        <!-- Indicador de carga de Firebase -->
        <div id="firebaseLoading" class="text-center" style="display: none;">
          <small class="text-muted">
            <i class="fas fa-spinner fa-spin me-1"></i>Cargando Firebase...
          </small>
        </div>
        
        <!-- Botón de registro -->
        <div class="mt-2 text-center">
          <button class="btn btn-outline-success btn-sm" onclick="mostrarModalRegistro()">
            <i class="fas fa-user-plus me-1"></i>Crear Cuenta
          </button>
        </div>
        <!-- Botón de instalación -->
        <div class="mt-2 text-center">
          <button id="installButton" class="btn btn-outline-info btn-sm" onclick="installPWA()">
            <i class="fas fa-download me-1"></i>Instalar App
          </button>
        </div>
      </div>

      <!-- Sección de la Aplicación -->
      <div id="appSection" class="container-fluid" style="display: none;">
        <div class="logo-container">
          <img src="image/logo-ToySoft.png" alt="Logo" class="img-fluid" style="max-width: 100px;">
          <h1 class="text-info">POS</h1>
          <h2 class="mb-2 text-center">By Emil Jiménez Ortiz</h2>
        </div>
        
          <div class="nav-buttons d-flex flex-column gap-2 align-items-center text-center mx-auto" style="max-width: 350px;">
            <a href="POS.html" class="btn btn-info btn-md w-100">
              <i class="fas fa-cash-register me-1"></i> Punto de Venta
            </a>
            <a href="admon.html" class="btn btn-outline-info btn-md w-100">
              <i class="fas fa-cog me-1"></i> Administración
            </a>
            <button class="btn btn-outline-success btn-md w-100" onclick="mostrarAcercaDe()">
              <i class="fas fa-info-circle me-1"></i> Acerca de
            </button>
            <button class="btn btn-danger btn-md w-100" onclick="cerrarSesion()">
              <i class="fas fa-sign-out-alt me-1"></i> Cerrar Sesión
            </button>
          </div>
        </div>
      </div>

      <!-- Sección de Punto de Venta -->
      <div id="posSection" class="pos-container" style="display: none;">
        <div class="row">
          <!-- Panel de Mesas -->
          <div class="col-md-3">
            <div class="mesas-panel">
              <h3>Mesas</h3>
              <div class="input-group mb-3">
                <input type="text" id="nuevaMesa" class="form-control" placeholder="Número de mesa">
                <button class="btn btn-info" id="btnNuevaMesa">Nueva Mesa</button>
              </div>
              <div id="mesasContainer" class="mesas-grid"></div>
              <div class="pedidos-buttons mt-3">
                <button class="btn btn-warning" onclick="crearPedidoDomicilio()">
                  <i class="fas fa-motorcycle"></i> Domicilio
                </button>
                <button class="btn btn-info" onclick="crearPedidoRecoger()">
                  <i class="fas fa-shopping-bag"></i> Recoger
                </button>
              </div>
            </div>
          </div>

          <!-- Panel de Productos y Orden -->
          <div class="col-md-9">
            <div class="row">
              <!-- Panel de Productos -->
              <div class="col-md-8">
                <div class="productos-panel">
                  <h3>Productos</h3>
                  <div id="categorias" class="mb-3"></div>
                  <div class="table-responsive">
                    <table class="table table-dark">
                      <thead>
                        <tr>
                          <th>Producto</th>
                          <th>Acción</th>
                          <th>Precio</th>
                        </tr>
                      </thead>
                      <tbody id="ordenCuerpo"></tbody>
                    </table>
                  </div>
                </div>
              </div>

              <!-- Panel de Orden -->
              <div class="col-md-4">
                <div class="orden-panel">
                  <h3>Orden - <span id="mesaActual">-</span></h3>
                  <div class="table-responsive">
                    <table class="table table-dark">
                      <thead>
                        <tr>
                          <th>Producto</th>
                          <th>Cant</th>
                          <th>Precio</th>
                          <th>Total</th>
                          <th>Detalles</th>
                          <th>Acción</th>
                        </tr>
                      </thead>
                      <tbody id="ordenCuerpo"></tbody>
                    </table>
                  </div>
                  <div class="orden-totales">
                    <div class="mb-2">
                      <label class="form-label">Propina (%)</label>
                      <input type="number" id="propina" class="form-control" value="0">
                    </div>
                    <div class="mb-2">
                      <label class="form-label">Descuento</label>
                      <input type="number" id="descuento" class="form-control" value="0">
                    </div>
                    <div id="desgloseTotal" class="mb-2"></div>
                    <h4>Total: <span id="totalOrden">$ 0</span></h4>
                  </div>
                  <div class="orden-acciones">
                    <button class="btn btn-warning" onclick="enviarACocina()">
                      <i class="fas fa-utensils"></i> Enviar a Cocina
                    </button>
                    <button class="btn btn-success" onclick="mostrarModalPago()">
                      <i class="fas fa-cash-register"></i> Generar Recibo
                    </button>
                    <button class="btn btn-danger" onclick="eliminarPedido()">
                      <i class="fas fa-trash"></i> Eliminar
                    </button>
                    <button class="btn btn-info" onclick="mostrarModalCierreDiario()">
                      <i class="fas fa-calculator"></i> Cierre de Caja
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal de Pago -->
    <div class="modal fade" id="modalPago" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content bg-dark text-white">
          <div class="modal-header">
            <h5 class="modal-title">Procesar Pago</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <!-- Sección de Clientes -->
            <div class="mb-3">
              <h6>Seleccionar Cliente</h6>
              <div id="listaClientesPago" class="list-group">
                <!-- Los clientes se cargarán aquí -->
              </div>
            </div>

            <!-- Método de Pago -->
            <div class="mb-3">
              <label class="form-label">Método de Pago</label>
              <select id="metodoPago" class="form-select bg-dark text-white border-light">
                <option value="efectivo">Efectivo</option>
                <option value="tarjeta">Tarjeta</option>
                <option value="transferencia">Transferencia</option>
              </select>
            </div>

            <!-- Sección de Efectivo -->
            <div id="efectivoSection">
              <div class="mb-3">
                <label class="form-label">Monto Recibido</label>
                <input type="number" id="montoRecibido" class="form-control bg-light text-success border-success" 
                       style="font-weight: bold; font-size: 1.2em;">
              </div>
              <div class="mb-3">
                <label class="form-label">Cambio</label>
                <div id="cambio" class="form-control bg-dark text-white border-light">$ 0</div>
              </div>
            </div>

            <!-- Sección de Transferencia -->
            <div id="transferenciaSection" style="display: none;">
              <div class="mb-3">
                <label class="form-label">Número de Transferencia</label>
                <input type="text" id="numeroTransferencia" class="form-control bg-dark text-white border-light">
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="button" class="btn btn-primary" onclick="procesarPago()">Confirmar Pago</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal de Cierre de Caja -->
    <div class="modal fade" id="modalCierreDiario" tabindex="-1" aria-labelledby="modalCierreDiarioLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content bg-dark text-white">
          <div class="modal-header">
            <h5 class="modal-title" id="modalCierreDiarioLabel">Cierre de Caja</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <h6>Resumen de Ventas</h6>
              <div>Total Ventas: <span id="totalVentasHoy">$ 0</span></div>
              <div>Total Efectivo: <span id="totalEfectivoHoy">$ 0</span></div>
              <div>Total Transferencias: <span id="totalTransferenciasHoy">$ 0</span></div>
            </div>
            <div class="mb-3">
              <h6>Gastos del Día</h6>
              <div>Total Gastos: <span id="totalGastosHoy">$ 0</span></div>
            </div>
            
            <div class="mb-3">
              <h6>Balance Final</h6>
              <div>Balance: <span id="balanceFinal">$ 0</span></div>
            </div>
            
            <div class="mb-3">
              <label class="form-label">Detalles Adicionales</label>
              <textarea class="form-control bg-dark text-white border-light" id="detallesCierre" rows="3"></textarea>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="button" class="btn btn-primary" onclick="guardarCierreDiario()">Guardar Cierre</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal de Gastos -->
    <div class="modal fade" id="modalGastos" tabindex="-1" aria-labelledby="modalGastosLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content bg-dark text-white">
          <div class="modal-header">
            <h5 class="modal-title" id="modalGastosLabel">Gestión de Gastos</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <!-- Formulario de Gastos -->
            <form id="formGasto" class="mb-4">
              <div class="row">
                <div class="col-md-4">
                  <div class="mb-3">
                    <label for="descripcionGasto" class="form-label">Descripción</label>
                    <input type="text" class="form-control bg-dark text-white border-light" id="descripcionGasto" required>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="mb-3">
                    <label for="montoGasto" class="form-label">Monto</label>
                    <input type="number" class="form-control bg-dark text-white border-light" id="montoGasto" required>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="mb-3">
                    <label for="fechaGasto" class="form-label">Fecha</label>
                    <input type="date" class="form-control bg-dark text-white border-light" id="fechaGasto" required>
                  </div>
                </div>
              </div>
              <button type="button" class="btn btn-info" id="btnGuardarGasto" onclick="guardarGasto()">
                <i class="fas fa-save"></i> Guardar Gasto
              </button>
            </form>

            <!-- Tabla de Gastos -->
            <div class="table-responsive">
              <table class="table table-dark" id="tablaGastos">
                <thead>
                  <tr>
                    <th>Fecha</th>
                    <th>Descripción</th>
                    <th>Monto</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- Los gastos se cargarán aquí -->
                </tbody>
              </table>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal de Configuración de Cierre -->
    <div class="modal fade" id="modalConfiguracionCierre" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content bg-dark text-white">
          <div class="modal-header">
            <h5 class="modal-title">Configurar Hora de Cierre</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="activarHoraCierre">
                <label class="form-check-label" for="activarHoraCierre">
                  Activar hora de cierre automático
                </label>
              </div>
              <small class="text-muted">Si desactiva esta opción, no habrá restricciones de horario</small>
            </div>
            <div id="configuracionHora" class="mb-3">
              <label class="form-label">Hora de Cierre</label>
              <div class="input-group">
                <input type="number" id="horaCierre" class="form-control bg-dark text-white border-light" 
                       min="1" max="12" value="11" placeholder="Hora (1-12)">
                <span class="input-group-text bg-dark text-white border-light">:</span>
                <input type="number" id="minutoCierre" class="form-control bg-dark text-white border-light" 
                       min="0" max="59" value="30" placeholder="Minutos (0-59)">
                <select id="periodoCierre" class="form-select bg-dark text-white border-light">
                  <option value="AM">AM</option>
                  <option value="PM" selected>PM</option>
                </select>
              </div>
              <small class="text-muted">Ejemplo: 11:30 PM para cerrar a las 11:30 de la noche</small>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="button" class="btn btn-primary" onclick="guardarConfiguracionCierre()">Guardar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal de Ayuda Contextual -->
    <div class="modal fade" id="modalAyuda" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content bg-dark text-white">
          <div class="modal-header">
            <h5 class="modal-title">
              <i class="fas fa-question-circle text-info"></i>
              Ayuda: <span id="tituloAyuda">Página Principal</span>
            </h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div id="contenidoAyuda"></div>
            <div id="enlacesAyuda" class="mt-3">
              <h6>Enlaces Relacionados:</h6>
              <div class="list-group list-group-flush bg-dark">
                <!-- Enlaces dinámicos -->
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Acerca de -->
    <div class="modal fade" id="modalAcercaDe" tabindex="-1">
      <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content bg-dark text-white">
          <div class="modal-header">
            <h5 class="modal-title">
              <i class="fas fa-info-circle text-info"></i>
              Acerca de ToySoft
            </h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div class="text-center mb-3">
              <img src="image/logo-ToySoft.png" alt="ToySoft Logo" class="img-fluid" style="max-width: 100px;">
              <h4 class="text-info mt-2">ToySoft</h4>
              <p class="text-muted mb-0">Versión 1.0 - Sistema de Punto de Venta</p>
            </div>
            
            <div class="row g-3">
              <div class="col-md-6">
                <h6><i class="fas fa-star text-warning"></i> Características</h6>
                <ul class="list-unstyled small">
                  <li><i class="fas fa-check text-success me-1"></i>Sistema POS completo</li>
                  <li><i class="fas fa-check text-success me-1"></i>Gestión de inventario</li>
                  <li><i class="fas fa-check text-success me-1"></i>Control de gastos</li>
                  <li><i class="fas fa-check text-success me-1"></i>Historial de ventas</li>
                  <li><i class="fas fa-check text-success me-1"></i>Interfaz moderna y responsive</li>
                  <li><i class="fas fa-check text-success me-1"></i>Instalable como PWA</li>
                </ul>
              </div>
              <div class="col-md-6">
                <h6><i class="fas fa-heart text-danger"></i> Soporte</h6>
                <p class="small mb-2">Esta es una versión desarrollada para ayudar a pequeños negocios.</p>
                <div class="text-center">
                  <a href="https://wa.me/573192364724" target="_blank" class="btn btn-success btn-sm">
                    <i class="fab fa-whatsapp me-1"></i>Contactar por WhatsApp
                  </a>
                  <p class="mt-1 small">Colombia: +57 319 236 4724</p>
                </div>
              </div>
            </div>
            
            <!-- Nueva sección sobre versión completa -->
            <div class="mt-3 p-3 bg-primary rounded">
              <div class="text-center">
                <h6><i class="fas fa-crown text-warning"></i> ¿Necesitas Más Funcionalidades?</h6>
                <p class="mb-2 small">Si tu negocio requiere funcionalidades avanzadas:</p>
                <div class="row g-2 text-start">
                  <div class="col-md-6">
                    <ul class="list-unstyled small">
                      <li><i class="fas fa-plus text-success me-1"></i>Múltiples sucursales</li>
                      <li><i class="fas fa-plus text-success me-1"></i>Reportes avanzados</li>
                      <li><i class="fas fa-plus text-success me-1"></i>Integración con impresoras</li>
                      <li><i class="fas fa-plus text-success me-1"></i>Backup en la nube</li>
                    </ul>
                  </div>
                  <div class="col-md-6">
                    <ul class="list-unstyled small">
                      <li><i class="fas fa-plus text-success me-1"></i>Soporte técnico prioritario</li>
                      <li><i class="fas fa-plus text-success me-1"></i>Personalización completa</li>
                      <li><i class="fas fa-plus text-success me-1"></i>Capacitación incluida</li>
                      <li><i class="fas fa-plus text-success me-1"></i>Actualizaciones continuas</li>
                    </ul>
                  </div>
                </div>
                <div class="mt-2">
                  <a href="https://wa.me/573192364724?text=Hola,%20me%20interesa%20conocer%20más%20sobre%20la%20versión%20completa%20de%20ToySoft" target="_blank" class="btn btn-warning btn-sm">
                    <i class="fas fa-crown me-1"></i>¡Solicitar Versión Completa!
                  </a>
                  <p class="mt-1 small text-light">Consulta precios y características especiales</p>
                </div>
              </div>
            </div>
            
            <div class="mt-3 p-2 bg-secondary rounded">
              <h6 class="small"><i class="fas fa-info-circle text-info"></i> Información Legal</h6>
              <p class="mb-1 small">• Esta es una versión paga del software ToySoft</p>
              <p class="mb-1 small">• Es utilizada para fines comerciales</p>
              <p class="mb-1 small">• Se requiere pago por su uso</p>
              <p class="mb-0 small">• Desarrollado por Emil Jiménez Ortiz</p>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cerrar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal de Registro -->
    <div class="modal fade" id="modalRegistro" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content bg-dark text-white">
          <div class="modal-header">
            <h5 class="modal-title">
              <i class="fas fa-user-plus text-success"></i>
              Crear Nueva Cuenta
            </h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <form id="formRegistro">
              <div class="mb-3">
                <label for="nombreNegocio" class="form-label">Nombre del Negocio</label>
                <input type="text" id="nombreNegocio" class="form-control bg-dark text-white border-light" required>
              </div>
              <div class="mb-3">
                <label for="emailRegistro" class="form-label">Correo Electrónico</label>
                <input type="email" id="emailRegistro" class="form-control bg-dark text-white border-light" required>
              </div>
              <div class="mb-3">
                <label for="passwordRegistro" class="form-label">Contraseña</label>
                <input type="password" id="passwordRegistro" class="form-control bg-dark text-white border-light" required minlength="6">
                <small class="text-muted">Mínimo 6 caracteres</small>
              </div>
              <div class="mb-3">
                <label for="confirmPassword" class="form-label">Confirmar Contraseña</label>
                <input type="password" id="confirmPassword" class="form-control bg-dark text-white border-light" required>
              </div>
              <div class="mb-3">
                <label for="telefono" class="form-label">Teléfono (opcional)</label>
                <input type="tel" id="telefono" class="form-control bg-dark text-white border-light">
              </div>
            </form>
            <div id="mensajeRegistro" class="alert" style="display: none;"></div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancelar</button>
            <button type="button" class="btn btn-success btn-sm" onclick="registrarUsuario()">
              <i class="fas fa-user-plus me-1"></i>Crear Cuenta
            </button>
          </div>
        </div>
      </div>
    </div>

    <footer class="text-center py-1 mt-1">
      <div class="container">
        <div class="row g-1">
          <div class="col-md-6">
            <p class="mb-0 small">&copy; 2025 Emil Jiménez Ortiz - Desarrollador Web</p>
            <p class="mb-0 small" style="color: #0dcaf0;"><strong>Soluciones de Software</strong></p>
          </div>
          <div class="col-md-6">
            <p class="mb-0 small">¿Necesitas ayuda o soporte técnico?</p>
            <a href="https://wa.me/573192364724" target="_blank" class="btn btn-success btn-sm">
              <i class="fab fa-whatsapp me-1"></i>Contactar por WhatsApp
            </a>
            <p class="mt-0 small text-muted">Colombia: +57 319 236 4724</strong></p>
          </div>
        </div>
      </div>
    </footer>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  
  <!-- Firebase Scripts -->
  <script type="module" src="firebase-config.js"></script>
  <script src="firebase-auth.js"></script>
  
  <script src="seguridad.js"></script>
  <script src="install.js"></script>
  <script src="ayuda.js"></script>
  <script src="app.js"></script>
  
  <script>
    // Funciones de Firebase Authentication
    async function iniciarSesionFirebase() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      
      if (!email || !password) {
        mostrarMensaje('Por favor completa todos los campos', 'warning');
        return;
      }
      
      try {
        // Verificar que Firebase esté cargado
        if (!window.firebaseAuthManager) {
          console.log('Firebase Auth Manager no está listo, esperando...');
          await new Promise(resolve => setTimeout(resolve, 2000));
          
          if (!window.firebaseAuthManager) {
            mostrarMensaje('Error: Firebase no está cargado. Recarga la página.', 'danger');
            return;
          }
        }
        
        const resultado = await window.firebaseAuthManager.loginUser(email, password);
        if (resultado.success) {
          mostrarMensaje('¡Inicio de sesión exitoso!', 'success');
          // La redirección se maneja automáticamente en onUserLogin
        } else {
          mostrarMensaje('Error: ' + resultado.error, 'danger');
        }
      } catch (error) {
        mostrarMensaje('Error al iniciar sesión: ' + error.message, 'danger');
      }
    }

    async function iniciarSesionGoogle() {
      try {
        console.log('=== INICIO LOGIN GOOGLE ===');
        console.log('1. Verificando Firebase Auth Manager...');
        
        // Verificar que Firebase esté cargado
        if (!window.firebaseAuthManager) {
          console.log('❌ Firebase Auth Manager no está listo, esperando...');
          await new Promise(resolve => setTimeout(resolve, 2000));
          
          if (!window.firebaseAuthManager) {
            console.log('❌ Firebase Auth Manager aún no está disponible');
            mostrarMensaje('Error: Firebase no está cargado. Recarga la página.', 'danger');
            return;
          }
        }
        
        console.log('✅ Firebase Auth Manager encontrado');
        console.log('2. Verificando método loginWithGoogle...');
        
        if (!window.firebaseAuthManager.loginWithGoogle) {
          console.log('❌ Método loginWithGoogle no existe');
          mostrarMensaje('Error: Método de Google no disponible', 'danger');
          return;
        }
        
        console.log('✅ Método loginWithGoogle encontrado');
        console.log('3. Iniciando login con Google...');
        
        const resultado = await window.firebaseAuthManager.loginWithGoogle();
        console.log('4. Resultado del login:', resultado);
        
        if (resultado.success) {
          console.log('✅ Login con Google exitoso');
          mostrarMensaje('¡Inicio de sesión con Google exitoso!', 'success');
          // La redirección se maneja automáticamente en onUserLogin
        } else {
          console.log('❌ Error en login:', resultado.error);
          mostrarMensaje('Error: ' + resultado.error, 'danger');
        }
      } catch (error) {
        console.log('❌ Excepción en login con Google:', error);
        console.error('Error completo:', error);
        mostrarMensaje('Error al iniciar sesión con Google: ' + error.message, 'danger');
      }
    }

    function mostrarModalRegistro() {
      const modal = new bootstrap.Modal(document.getElementById('modalRegistro'));
      modal.show();
    }

    async function registrarUsuario() {
      const nombreNegocio = document.getElementById('nombreNegocio').value;
      const email = document.getElementById('emailRegistro').value;
      const password = document.getElementById('passwordRegistro').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      const telefono = document.getElementById('telefono').value;
      
      if (!nombreNegocio || !email || !password || !confirmPassword) {
        mostrarMensajeRegistro('Por favor completa todos los campos obligatorios', 'warning');
        return;
      }
      
      if (password !== confirmPassword) {
        mostrarMensajeRegistro('Las contraseñas no coinciden', 'danger');
        return;
      }
      
      if (password.length < 6) {
        mostrarMensajeRegistro('La contraseña debe tener al menos 6 caracteres', 'danger');
        return;
      }
      
      try {
        const userData = {
          displayName: nombreNegocio,
          telefono: telefono,
          role: 'admin'
        };
        
        const resultado = await window.firebaseAuthManager.registerUser(email, password, userData);
        if (resultado.success) {
          mostrarMensajeRegistro('¡Cuenta creada exitosamente!', 'success');
          setTimeout(() => {
            bootstrap.Modal.getInstance(document.getElementById('modalRegistro')).hide();
          }, 2000);
        } else {
          mostrarMensajeRegistro('Error: ' + resultado.error, 'danger');
        }
      } catch (error) {
        mostrarMensajeRegistro('Error al crear cuenta: ' + error.message, 'danger');
      }
    }

    function mostrarMensajeRegistro(mensaje, tipo) {
      const alertDiv = document.getElementById('mensajeRegistro');
      alertDiv.className = `alert alert-${tipo}`;
      alertDiv.textContent = mensaje;
      alertDiv.style.display = 'block';
    }

    function mostrarMensaje(mensaje, tipo) {
      // Crear un toast o alert temporal
      const alertDiv = document.createElement('div');
      alertDiv.className = `alert alert-${tipo} alert-dismissible fade show position-fixed`;
      alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
      alertDiv.innerHTML = `
        ${mensaje}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      `;
      document.body.appendChild(alertDiv);
      
      // Remover después de 5 segundos
      setTimeout(() => {
        if (alertDiv.parentNode) {
          alertDiv.parentNode.removeChild(alertDiv);
        }
      }, 5000);
    }

    // Función para cerrar sesión con Firebase
    async function cerrarSesionFirebase() {
      try {
        await window.firebaseAuthManager.logoutUser();
        mostrarMensaje('Sesión cerrada exitosamente', 'info');
      } catch (error) {
        mostrarMensaje('Error al cerrar sesión: ' + error.message, 'danger');
      }
    }

    // Reemplazar la función de cerrar sesión existente
    function cerrarSesion() {
      cerrarSesionFirebase();
    }

    // Función para mostrar el modal "Acerca de"
    function mostrarAcercaDe() {
      const modal = new bootstrap.Modal(document.getElementById('modalAcercaDe'));
      modal.show();
    }

    // Función para verificar si Firebase está listo
    function verificarFirebaseListo() {
      if (window.firebaseAuthManager) {
        document.getElementById('firebaseLoading').style.display = 'none';
        document.getElementById('btnGoogle').disabled = false;
        console.log('Firebase está listo para usar');
      } else {
        document.getElementById('firebaseLoading').style.display = 'block';
        document.getElementById('btnGoogle').disabled = true;
        setTimeout(verificarFirebaseListo, 500);
      }
    }

    // Al final de la verificación de sesión, oculta el loader y muestra el contenido principal
    function mostrarContenidoPrincipal(sesionActiva) {
      document.getElementById('customLoader').style.display = 'none';
      document.getElementById('mainContent').style.display = 'block';
      if (sesionActiva) {
        document.getElementById('loginSection').style.display = 'none';
        document.getElementById('appSection').style.display = 'block';
      } else {
        document.getElementById('loginSection').style.display = 'block';
        document.getElementById('appSection').style.display = 'none';
      }
    }

    // Modifica la inicialización para usar mostrarContenidoPrincipal
    document.addEventListener('DOMContentLoaded', function() {
      // Mostrar el loader por defecto
      document.getElementById('customLoader').style.display = 'flex';
      document.getElementById('mainContent').style.display = 'none';
      
      // Esperar a que Firebase se inicialice y verifique la sesión
      setTimeout(() => {
        let sesionActiva = false;
        if (window.firebaseAuthManager && window.firebaseAuthManager.isAuthenticated && window.firebaseAuthManager.isAuthenticated()) {
          sesionActiva = true;
        } else if (localStorage.getItem('sesionActiva') === 'true') {
          sesionActiva = true;
        }
        mostrarContenidoPrincipal(sesionActiva);
      }, 1200);
    });
  </script>
</body>
</html>
